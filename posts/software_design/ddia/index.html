<!doctype html><html class=no-js lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Designing Data-Intensive Applications - Kei's Blog</title>
<script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script>
<meta name=description content>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Designing Data-Intensive Applications">
<meta name=twitter:description content="What&rsquo;s this article about This is my notes of a book called Designing Data-Intensive Applications.
SSTables and LSM Trees(P.76) SSTables(Sorted String Tables) a file which contains a set of arbitrary and sorted key-value pairs inside.
 https://www.igvita.com/2012/02/06/sstable-and-log-structured-storage-leveldb/
SSTables and Log-Structured Merge Trees are still used in some database.
As a rule of thumb, LSM Trees are faster for writes but slower for read than B-Tree index.
B-Trees The B-Tree is the most widely used indexing structure.">
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link rel=dns-prefetch href=//fonts.googleapis.com>
<link rel=dns-prefetch href=//fonts.gstatic.com>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/css/custom.css>
<link rel="shortcut icon" href=/favicon.ico>
</head>
<body class=body>
<div class="container container--outer">
<header class=header>
<div class="container header__container">
<div class=logo>
<a class=logo__link href=/ title="Kei's Blog" rel=home>
<div class="logo__item logo__text">
<div class=logo__title>Kei's Blog</div>
</div>
</a>
</div>
<div class=divider></div>
</div>
</header>
<div class="wrapper flex">
<div class=primary>
<main class=main role=main>
<article class=post>
<header class=post__header>
<h1 class=post__title>Designing Data-Intensive Applications</h1>
<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2022-11-26T00:00:00Z>November 26, 2022</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/software-design/ rel=category>Software Design</a>
</span>
</div></div>
</header>
<div class="post__toc toc">
<div class=toc__title>Page content</div>
<div class=toc__menu>
<nav id=TableOfContents>
<ul>
<li><a href=#whats-this-article-about>What&rsquo;s this article about</a>
<ul>
<li><a href=#sstables-and-lsm-treesp76>SSTables and LSM Trees(P.76)</a></li>
<li><a href=#b-trees>B-Trees</a></li>
<li><a href=#index>Index</a></li>
<li><a href=#in-memory-database>In-Memory Database</a></li>
<li><a href=#oltp-and-olap>OLTP and OLAP</a></li>
</ul>
</li>
<li><a href=#4-encoding-and-evaluation-page-111>4. Encoding and Evaluation. Page 111</a>
<ul>
<li><a href=#formats-for-encoding-data>Formats for Encoding data</a></li>
</ul>
</li>
<li><a href=#chapter-5-replication>Chapter 5 Replication</a></li>
<li><a href=#failover-is-fraught-with-things-that-can-go-wrong>Failover is fraught with things that can go wrong</a>
<ul>
<li><a href=#github-incident>github incident</a></li>
<li><a href=#split-brain>Split brain</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div><div class="content post__content clearfix">
<h2 id=whats-this-article-about>What&rsquo;s this article about</h2>
<p>This is my notes of a book called <code>Designing Data-Intensive Applications</code>.</p>
<h3 id=sstables-and-lsm-treesp76>SSTables and LSM Trees(P.76)</h3>
<p>SSTables(Sorted String Tables) a file which contains a set of arbitrary and sorted key-value pairs inside.</p>
<p><figure><img src=./SSTables.png alt=SSTables width=100%>
</figure>
<a href=https://www.igvita.com/2012/02/06/sstable-and-log-structured-storage-leveldb/>https://www.igvita.com/2012/02/06/sstable-and-log-structured-storage-leveldb/</a></p>
<p>SSTables and Log-Structured Merge Trees are still used in some database.</p>
<p>As a rule of thumb, LSM Trees are faster for writes but slower for read than B-Tree index.</p>
<h3 id=b-trees>B-Trees</h3>
<p>The B-Tree is the most widely used indexing structure.</p>
<p>It stores data in a balanced tree like image below, thus searching data can be done in O(logN).</p>
<figure><img src=./b_tree_branches.png alt=B-Tree width=75%>
</figure>
<p>Each B-Tree parent page has references to child pages, and the number of references that a parent page can have is called <code>branching factor</code>, which is 6 in the case above but typically several hundred.</p>
<h3 id=index>Index</h3>
<p><code>Primary index</code> is index that resolves references to primary key that can identify each record.</p>
<p><code>Secondary index</code>, whereas, is not necessary references to unique keys.</p>
<h3 id=in-memory-database>In-Memory Database</h3>
<p>In-memory database archives durability by writing data to disks.</p>
<p>Redis has <code>weak durability</code> as it writes to disks asynchronously.</p>
<p>The reason why in-memory database has advantages on performance is not because it doesn&rsquo;t need to read from disks, but because they don&rsquo;t need to encode data in a form that can be written to disks.</p>
<h3 id=oltp-and-olap>OLTP and OLAP</h3>
<p><code>OLTP</code> is online transaction processing, and <code>OLAP</code> is online analytic processing.</p>
<p>The difference is not clear-cut, but here are some main characteristics of these two.</p>
<h4 id=oltp>OLTP</h4>
<ul>
<li>Main Read Pattern: Small number of records per query, fetched by key</li>
<li>Main Write Pattern: Random-Access, low-latency writes from user input</li>
<li>Primary used by: End user</li>
<li>What data represents: Latest state of data</li>
<li>Dataset Size: Gigabytes to Terabytes</li>
</ul>
<h4 id=olap>OLAP</h4>
<ul>
<li>Main Read Pattern: Aggregate over large number of records</li>
<li>Main Write Pattern: Bulk import or event stream</li>
<li>Primary used by: Internal analyst</li>
<li>What data represents: History of events</li>
<li>Dataset Size: Terabytes to Petabytes</li>
</ul>
<h2 id=4-encoding-and-evaluation-page-111>4. Encoding and Evaluation. Page 111</h2>
<h3 id=formats-for-encoding-data>Formats for Encoding data</h3>
<p>The translation from the <code>in-memory representation</code> to a <code>byte sequence</code> is called encoding(a.k.a marshalling or serialization). The reverse is called decoding, parsing, unmarshalling, or deserialization</p>
<h4 id=grpccompatibility>gRPC(compatibility)</h4>
<p>Forward Compatibility: If new code reads data from the old protobuf including new fields, it just ignores new fields. So the forward compatibility remains.</p>
<p>Backward Compatibility: If you add a new required field, then old code cannot read from the old protobuf. So you cannot add required fields afterwards</p>
<h4 id=message-broker-and-actor-modelp137>Message Broker and Actor model(P.137)</h4>
<p><code>Message Broker</code></p>
<p>One message sends a message to a named queue or topic, and broker ensures that the message is delivered to at least one consumers or subscribers to that topic or queue. There can be many producers and consumers on the same topic.</p>
<p>Producer and Consumer Pattern Ref.(Japanese)
<a href=https://www.hyuki.com/dp/dpinfo.html#ProducerConsumer>https://www.hyuki.com/dp/dpinfo.html#ProducerConsumer</a></p>
<p>English
<a href=https://cloud.google.com/pubsub/docs/overview>https://cloud.google.com/pubsub/docs/overview</a></p>
<p><code>Actor Model</code></p>
<p>Location transparency is the ability to access objects without the knowledge of their location.</p>
<p>Actor model is a programming model for concurrency in a single process.</p>
<p>Each actor typically represents one entity or client and usually has local state.</p>
<p>It communicates with other actors by sending and receiving asynchronous messages.</p>
<p>Ref.
<a href="https://www.youtube.com/watch?v=ELwEdb_pD0k">https://www.youtube.com/watch?v=ELwEdb_pD0k</a></p>
<h2 id=chapter-5-replication>Chapter 5 Replication</h2>
<h2 id=failover-is-fraught-with-things-that-can-go-wrong>Failover is fraught with things that can go wrong</h2>
<p>When the <code>leader(master or primary)</code> node failed, one of the <code>followers(read replicas, slaves, secondaries, or hot standby)</code> is promoted to be a new leader, and this process is called <code>Failover</code>.</p>
<p>Failover is fraught with things that can go wrong.</p>
<h3 id=github-incident>github incident</h3>
<p>Discarding failed writes of the leader is dangerous especially when it has to coordinate with other storage systems outside the database.</p>
<p>There is an incident because of the leader crushing in Github.</p>
<p>An out-dated follower became the leader.</p>
<p>The database used the auto incrementing primary key, and the new leader used the primary key, which is already used in the old reader.
It&rsquo;s also used in redis, thus it created the inconsistency between redis and database data.</p>
<h3 id=split-brain>Split brain</h3>
<p>When two nodes both believe that they are the leader is called <code>split brain</code>.
It could lead data corruption and loss.</p>
</div>
<footer class=post__footer>
<div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg>
<ul class=tags__list>
<li class=tags__item>
<a class="tags__link btn" href=/tags/distributed-system/ rel=tag>Distributed System</a>
</li>
<li class=tags__item>
<a class="tags__link btn" href=/tags/db/ rel=tag>DB</a>
</li>
<li class=tags__item>
<a class="tags__link btn" href=/tags/english-article/ rel=tag>English Article</a>
</li>
</ul>
</div>
</footer>
</article>
</main>
<div class="authorbox clearfix">
<figure class=authorbox__avatar>
<img alt="Keigo Kida avatar" src=/img/avatar.jpeg class=avatar height=90 width=90>
</figure>
<div class=authorbox__header>
<span class=authorbox__name>About Keigo Kida</span>
</div>
<div class=authorbox__description>
Software Engineer living in Japan
</div>
</div>
</div>
<aside class=sidebar>
<div class="widget-recent widget">
<h4 class=widget__title>Recent Posts</h4>
<div class=widget__content>
<ul class=widget__list>
<li class=widget__item><a class=widget__link href=/posts/software_design/ddia/>Designing Data-Intensive Applications</a></li>
<li class=widget__item><a class=widget__link href=/posts/dsa/dijkstra/>Dijkstra’s Shortest Path Algorithm</a></li>
<li class=widget__item><a class=widget__link href=/posts/dsa/topological_sort/>Topological Sort</a></li>
<li class=widget__item><a class=widget__link href=/posts/public_cloud/essential_cloud_infrastructure_foundation/>Essential Cloud Infrastructure: Foundation</a></li>
<li class=widget__item><a class=widget__link href=/posts/public_cloud/google_cloud_fundamentals/>Google Cloud Fundamentals</a></li>
</ul>
</div>
</div>
<div class="widget-categories widget">
<h4 class=widget__title>Categories</h4>
<div class=widget__content>
<ul class=widget__list>
<li class=widget__item>
<a class=widget__link href=/categories/cs/>CS</a></li>
<li class=widget__item>
<a class=widget__link href=/categories/dsa/>DSA</a></li>
<li class=widget__item>
<a class=widget__link href=/categories/frontend/>Frontend</a></li>
<li class=widget__item>
<a class=widget__link href=/categories/middleware/>Middleware</a></li>
<li class=widget__item>
<a class=widget__link href=/categories/ml/>ML</a></li>
<li class=widget__item>
<a class=widget__link href=/categories/programming-language/>Programming Language</a></li>
<li class=widget__item>
<a class=widget__link href=/categories/public-cloud/>Public Cloud</a></li>
<li class=widget__item>
<a class=widget__link href=/categories/security/>Security</a></li>
<li class=widget__item>
<a class=widget__link href=/categories/software-design/>Software Design</a></li>
<li class=widget__item>
<a class=widget__link href=/categories/system-design/>System Design</a></li>
</ul>
</div>
</div>
<div class="widget-taglist widget">
<h4 class=widget__title>Tags</h4>
<div class=widget__content>
<a class="widget-taglist__link widget__link btn" href=/tags/array/ title=Array>Array</a>
<a class="widget-taglist__link widget__link btn" href=/tags/asynchronous-programming/ title="Asynchronous Programming">Asynchronous Programming</a>
<a class="widget-taglist__link widget__link btn" href=/tags/aws/ title=AWS>AWS</a>
<a class="widget-taglist__link widget__link btn" href=/tags/bfs/ title=BFS>BFS</a>
<a class="widget-taglist__link widget__link btn" href=/tags/c++/ title=C++>C++</a>
<a class="widget-taglist__link widget__link btn" href=/tags/cnn/ title=CNN>CNN</a>
<a class="widget-taglist__link widget__link btn" href=/tags/db/ title=DB>DB</a>
<a class="widget-taglist__link widget__link btn" href=/tags/design-pattern/ title="Design Pattern">Design Pattern</a>
<a class="widget-taglist__link widget__link btn" href=/tags/dfs/ title=DFS>DFS</a>
<a class="widget-taglist__link widget__link btn" href=/tags/distributed-system/ title="Distributed System">Distributed System</a>
<a class="widget-taglist__link widget__link btn" href=/tags/english-article/ title="English Article">English Article</a>
<a class="widget-taglist__link widget__link btn" href=/tags/gcp/ title=GCP>GCP</a>
<a class="widget-taglist__link widget__link btn" href=/tags/go/ title=Go>Go</a>
<a class="widget-taglist__link widget__link btn" href=/tags/graph/ title=Graph>Graph</a>
<a class="widget-taglist__link widget__link btn" href=/tags/hash-set/ title="Hash Set">Hash Set</a>
<a class="widget-taglist__link widget__link btn" href=/tags/hash-table/ title="Hash Table">Hash Table</a>
<a class="widget-taglist__link widget__link btn" href=/tags/heap/ title=Heap>Heap</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ipc/ title=IPC>IPC</a>
<a class="widget-taglist__link widget__link btn" href=/tags/japanese-article/ title="Japanese Article">Japanese Article</a>
<a class="widget-taglist__link widget__link btn" href=/tags/javascript/ title=JavaScript>JavaScript</a>
<a class="widget-taglist__link widget__link btn" href=/tags/linked-list/ title="Linked List">Linked List</a>
<a class="widget-taglist__link widget__link btn" href=/tags/network/ title=Network>Network</a>
<a class="widget-taglist__link widget__link btn" href=/tags/oauth/ title=OAuth>OAuth</a>
<a class="widget-taglist__link widget__link btn" href=/tags/oop/ title=OOP>OOP</a>
<a class="widget-taglist__link widget__link btn" href=/tags/os/ title=OS>OS</a>
<a class="widget-taglist__link widget__link btn" href=/tags/python/ title=Python>Python</a>
<a class="widget-taglist__link widget__link btn" href=/tags/queue/ title=Queue>Queue</a>
<a class="widget-taglist__link widget__link btn" href=/tags/react/ title=React>React</a>
<a class="widget-taglist__link widget__link btn" href=/tags/redis/ title=Redis>Redis</a>
<a class="widget-taglist__link widget__link btn" href=/tags/redux/ title=Redux>Redux</a>
<a class="widget-taglist__link widget__link btn" href=/tags/stack/ title=Stack>Stack</a>
<a class="widget-taglist__link widget__link btn" href=/tags/terraform/ title=Terraform>Terraform</a>
<a class="widget-taglist__link widget__link btn" href=/tags/terraform-cloud/ title="Terraform Cloud">Terraform Cloud</a>
<a class="widget-taglist__link widget__link btn" href=/tags/tree/ title=Tree>Tree</a>
<a class="widget-taglist__link widget__link btn" href=/tags/trie/ title=Trie>Trie</a>
<a class="widget-taglist__link widget__link btn" href=/tags/web-vulnerability/ title="Web Vulnerability">Web Vulnerability</a>
</div>
</div>
<div class="widget-social widget">
<h4 class="widget-social__title widget__title">Social</h4>
<div class="widget-social__content widget__content">
<div class="widget-social__item widget__item">
<a class="widget-social__link widget__link btn" title=LinkedIn rel="noopener noreferrer" href=https://linkedin.com/in/keigo-k-70557314b target=_blank><svg class="widget-social__link-icon icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0 40v272c0 21.9 18.1 40 40 40h272c21.9.0 40-18.1 40-40V40c0-21.9-18.1-40-40-40H40C18.1.0.0 18.1.0 40zm312-8c4.6.0 8 3.4 8 8v272c0 4.6-3.4 8-8 8H40c-4.6.0-8-3.4-8-8V40c0-4.6 3.4-8 8-8H312zM59.5 87c0 15.2 12.3 27.5 27.5 27.5s27.5-12.3 27.5-27.5S102.2 59.5 87 59.5 59.5 71.8 59.5 87zM187 157h-1v-21h-45v152h47v-75c0-19.8 3.9-39 28.5-39 24.2.0 24.5 22.4 24.5 40v74h47v-83.5c0-40.9-8.7-72-56.5-72-23 0-38.2 12.6-44.5 24.5zM64 288h47.5V136H64V288z"/></svg>
<span>LinkedIn</span>
</a>
</div>
<div class="widget-social__item widget__item">
<a class="widget-social__link widget__link btn" title=GitHub rel="noopener noreferrer" href=https://github.com/moonorange target=_blank><svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0C85.9.0.0 85.8.0 191.7c0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2.0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8.0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7.0.0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4.0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5.0 25.6-.2 46.3-.2 52.6.0 5.1 3.5 11.1 13.2 9.2C329 348.2 384 276.4 384 191.7 384 85.8 298 0 192 0z"/></svg>
<span>GitHub</span>
</a>
</div>
</div>
</div>
</aside>
</div>
<footer class=footer>
<div class="container footer__container flex">
<div class=footer__copyright>
&copy; 2023 Keigo Kida.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span>
</div>
</div>
</footer>
</div>
<script async defer src=/js/menu.js></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>